<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Seerah Slides</title>
  <style>
    html, body { height: 100%; margin: 0; background: #111; }
    #frame { width: 100%; height: 100%; border: 0; background: #111; }
    #hud {
      position: fixed; left: 12px; bottom: 12px;
      padding: 6px 10px; border-radius: 8px;
      background: rgba(0,0,0,.55); color: #fff;
      font: 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <iframe id="frame"></iframe>
  <div id="hud">Loading…</div>

  <script>
    const frame = document.getElementById('frame');
    const hud = document.getElementById('hud');

    let files = [];
    let i = 0;

    function setIndex(newIndex) {
      i = Math.max(0, Math.min(files.length - 1, newIndex));
      const file = files[i];
      frame.src = file;
      hud.textContent = `${i + 1} / ${files.length} — ${file}`;
      const url = new URL(location.href);
      url.searchParams.set('s', file);
      history.replaceState(null, '', url.toString());
    }

    function next() { setIndex(i + 1); }
    function prev() { setIndex(i - 1); }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === 'PageDown' || e.key === ' ') next();
      if (e.key === 'ArrowLeft'  || e.key === 'PageUp') prev();
      if (e.key === 'Home') setIndex(0);
      if (e.key === 'End') setIndex(files.length - 1);
    });

    async function init() {
      const state = await (await fetch('./slide_state.json')).json();
      files = state.slides.map(s => `${s.id}.html`);

      const wanted = new URL(location.href).searchParams.get('s');
      const startAt = wanted ? files.indexOf(wanted) : 0;
      setIndex(startAt >= 0 ? startAt : 0);
    }

    init().catch(err => {
      hud.textContent = 'Failed to load slide_state.json';
      console.error(err);
    });
  </script>
</body>
</html>